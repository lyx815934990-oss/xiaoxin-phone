/* 微信聊天界面样式 */

/* ========== 聊天界面主容器 ========== */
.xiaoxin-wechat-chat-screen {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    background: #e0e0e0;
    position: relative;
    overflow: hidden;
}

/* ========== 导航栏 ========== */
.xiaoxin-wechat-chat-nav-bar {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    background: #ededed;
    border-bottom: 0.5px solid #d1d1d6;
    z-index: 99;
}

.xiaoxin-wechat-chat-nav-back {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000 !important; /* 与钱包页返回按钮一致，使用黑色 */
    cursor: pointer;
    user-select: none;
}

.xiaoxin-wechat-chat-nav-back:active {
    opacity: 0.6;
}

.xiaoxin-wechat-chat-nav-title {
    flex: 1;
    text-align: center;
    font-size: 17px;
    font-weight: 330; /* 改为适中，不加粗 */
    color: #000;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding: 0 16px;
    transition: color 0.3s ease;
}

.xiaoxin-wechat-chat-nav-title.xiaoxin-wechat-chat-typing {
    color: #888;
    font-style: italic;
    font-weight: 330;
}

.xiaoxin-wechat-chat-nav-more {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 330;
    color: #000;
    cursor: pointer;
    user-select: none;
}

.xiaoxin-wechat-chat-nav-more:active {
    opacity: 0.6;
}

/* ========== 聊天内容区域 ========== */
.xiaoxin-wechat-chat-content-area {
    flex: 1;
    overflow: hidden;
    margin-top: 44px; /* 导航栏 */
    margin-bottom: 94px; /* 适配底部安全区 */
}

.xiaoxin-wechat-chat-messages-list {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 12px 16px;
    box-sizing: border-box;
    -webkit-overflow-scrolling: touch;
}

/* 隐藏滚动条 */
.xiaoxin-wechat-chat-messages-list::-webkit-scrollbar {
    display: none;
    width: 0;
    height: 0;
    background: transparent;
}

.xiaoxin-wechat-chat-messages-list {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

/* ========== 消息项 ========== */
.xiaoxin-wechat-chat-message-item {
    margin-bottom: 12px;
    width: 100%;
    text-align: center; /* 确保时间戳居中显示 */
}

/* 时间戳 */
.xiaoxin-wechat-chat-message-timestamp {
    text-align: center;
    font-size: 12px;
    color: #999;
    margin-bottom: 8px;
    padding: 4px 12px;
    background: rgba(
        255,
        255,
        255,
        0.65
    ) !important; /* 浅灰色半透明底条，与系统消息一致 */
    border-radius: 4px;
    display: inline-block; /* 让底条只包裹文字宽度，保持居中显示 */
}

/* 消息内容容器 */
.xiaoxin-wechat-chat-message-content {
    display: flex;
    align-items: flex-start;
    flex-wrap: wrap; /* 允许换行，让文字转写容器显示在下方 */
    gap: 8px;
    max-width: 100%;
}

/*
 * 聊天左右两侧的气泡最大宽度限制：
 * 让气泡始终“落在两侧头像的内侧边界之内”，避免出现像图1那样横向铺满。
 *
 * 计算方式：
 * 容器左右 padding(16px*2) + 两侧头像(40px*2) + 气泡与头像间距(8px*2)
 * => 16*2 + 40*2 + 8*2 = 128px
 */
:root {
    --xiaoxin-wechat-chat-avatar-size: 40px;
    --xiaoxin-wechat-chat-side-padding: 16px;
    --xiaoxin-wechat-chat-avatar-gap: 8px;
    /* 适当放宽气泡最大宽度：让气泡更接近头像内侧边界，但仍不越界 */
    --xiaoxin-wechat-chat-bubble-max-width: calc(
        100% - (var(--xiaoxin-wechat-chat-side-padding) * 2) -
            (var(--xiaoxin-wechat-chat-avatar-size) * 2) -
            (var(--xiaoxin-wechat-chat-avatar-gap) * 2) + 30px
    );
}

/* 玩家消息（右侧） */
.xiaoxin-wechat-chat-message-player .xiaoxin-wechat-chat-message-content {
    flex-direction: row;
    justify-content: flex-end;
}

/* 角色消息（左侧） */
.xiaoxin-wechat-chat-message-contact .xiaoxin-wechat-chat-message-content {
    flex-direction: row;
    justify-content: flex-start;
}

/* 头像 */
.xiaoxin-wechat-chat-message-avatar {
    width: 40px;
    height: 40px;
    border-radius: 4px;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
}

/* 未接来电消息 */
.xiaoxin-wechat-chat-message-call-missed {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* 玩家侧：图标在右侧 */
.xiaoxin-wechat-chat-message-call-missed-player {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 6px;
}

.xiaoxin-wechat-chat-message-call-missed-player
    .xiaoxin-wechat-chat-call-missed-text {
    order: 1;
}

.xiaoxin-wechat-chat-message-call-missed-player
    .xiaoxin-wechat-chat-call-missed-icon {
    order: 2;
}

/* 角色侧：图标在左侧 */
.xiaoxin-wechat-chat-message-call-missed-contact {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 6px;
}

.xiaoxin-wechat-chat-message-call-missed-contact
    .xiaoxin-wechat-chat-call-missed-icon {
    order: 1;
}

.xiaoxin-wechat-chat-message-call-missed-contact
    .xiaoxin-wechat-chat-call-missed-text {
    order: 2;
}

.xiaoxin-wechat-chat-call-missed-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.xiaoxin-wechat-chat-call-missed-icon svg {
    width: 20px;
    height: 20px;
}

.xiaoxin-wechat-chat-call-missed-text {
    font-size: 14px;
    color: #000000;
}

/* 消息气泡 */
.xiaoxin-wechat-chat-message-bubble {
    max-width: var(--xiaoxin-wechat-chat-bubble-max-width);
    padding: 10px 14px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 330 !important; /* 统一字体粗细，使用 !important 确保不被覆盖 */
    line-height: 1.4;
    word-wrap: break-word;
    word-break: break-all;
    position: relative;
    text-align: left !important; /* 强制文本在气泡内左对齐 */
}

/* 确保消息气泡内的所有文本都是 400 粗细，并且左对齐 */
.xiaoxin-wechat-chat-message-bubble,
.xiaoxin-wechat-chat-message-bubble * {
    font-weight: 330 !important;
    text-align: left !important; /* 强制所有文本内容左对齐 */
}

/* 玩家消息气泡（右侧，绿色） */
.xiaoxin-wechat-chat-message-player .xiaoxin-wechat-chat-message-bubble {
    background: #95ec69;
    color: #000;
    border-top-right-radius: 0;
    position: relative;
}

/* 角色消息气泡（左侧，白色） */
.xiaoxin-wechat-chat-message-contact .xiaoxin-wechat-chat-message-bubble {
    background: #fff;
    color: #000;
    border-top-left-radius: 0;
    position: relative;
}

/* 气泡小三角（左侧） */
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-chat-message-bubble::before {
    content: "";
    position: absolute;
    top: 12px;
    left: -4px; /* 向内移动2px，让小三角延伸到气泡内部，消除缝隙 */
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-right: 6px solid #fff;
}

/* 气泡小三角（右侧） */
.xiaoxin-wechat-chat-message-player .xiaoxin-wechat-chat-message-bubble::after {
    content: "";
    position: absolute;
    top: 12px;
    right: -4px; /* 向内移动2px，让小三角延伸到气泡内部，消除缝隙 */
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 6px solid #95ec69;
}

/* 红包消息禁用默认气泡小三角（优先级更高，使用类选择器组合） */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-chat-message-bubble.xiaoxin-wechat-chat-message-redpacket::after {
    display: none !important;
    content: none !important;
    border: none !important;
    width: 0 !important;
    height: 0 !important;
}

/* 系统消息 */
.xiaoxin-wechat-chat-message-system {
    display: inline-block;
    background: rgba(
        255,
        255,
        255,
        0.65
    ) !important; /* 半透明条，随背景更显著 */
    color: #555 !important;
    font-size: 12px !important; /* 字号更小 */
    max-width: 85% !important; /* 增加长度，让条更长 */
    text-align: center !important; /* 文字居中显示 */
}

/* 系统消息的容器居中显示 */
.xiaoxin-wechat-chat-message-content.xiaoxin-wechat-chat-message-content-system {
    justify-content: center !important;
    width: 100% !important;
}

/* 红包领取系统消息 */
.xiaoxin-wechat-chat-message-redpacket-claim-notification {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 4px 12px;
}

/* 红包领取系统消息不显示气泡指向 */
.xiaoxin-wechat-chat-message-redpacket-claim-notification::after,
.xiaoxin-wechat-chat-message-redpacket-claim-notification::before {
    display: none !important;
    content: none !important;
}

.xiaoxin-wechat-chat-message-redpacket-claim-notification-content {
    display: flex;
    align-items: center;
    gap: 4px;
}

.xiaoxin-wechat-chat-message-redpacket-claim-icon {
    font-size: 16px;
    line-height: 1;
}

.xiaoxin-wechat-chat-message-redpacket-claim-text {
    font-size: 13px;
    color: #555;
}

.xiaoxin-wechat-chat-message-redpacket-claim-redpacket-word {
    color: #ff9c2c !important; /* 黄色 */
    font-weight: 500;
    font-size: 14px !important;
    line-height: 1.4;
    padding: 0 !important;
    margin: 0 !important;
    text-align: center !important;
    margin: 8px auto !important;
    max-width: 90% !important;
    border-radius: 10px !important;
    box-shadow: none !important;
}
.xiaoxin-wechat-chat-message-system::before,
.xiaoxin-wechat-chat-message-system::after {
    content: none !important;
    display: none !important;
}

/* 待发送预览消息 */
.xiaoxin-wechat-chat-message-pending {
    opacity: 0.6;
    position: relative;
}

.xiaoxin-wechat-chat-message-pending::after {
    content: "待发送";
    position: absolute;
    top: -18px;
    right: 0;
    font-size: 10px;
    color: #999;
    background: rgba(255, 255, 255, 0.8);
    padding: 2px 6px;
    border-radius: 4px;
    white-space: nowrap;
}

/* 图片消息 */
.xiaoxin-wechat-chat-message-image {
    padding: 0 !important;
    background: transparent !important;
    border-radius: 4px !important;
    overflow: hidden;
    max-width: 35vw; /* 最大宽度为屏幕宽度的35%（缩小显示） */
    display: inline-block; /* 让容器根据内容自适应 */
}

/* 图片消息禁用默认气泡的小三角 */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-chat-message-bubble.xiaoxin-wechat-chat-message-image::after,
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-chat-message-bubble.xiaoxin-wechat-chat-message-image::before {
    display: none !important;
    content: none !important;
    border: none !important;
    width: 0 !important;
    height: 0 !important;
}

.xiaoxin-wechat-chat-message-image-img {
    max-width: 35vw; /* 最大宽度为屏幕宽度的35%（缩小显示） */
    max-height: 280px; /* 最大高度限制（缩小） */
    width: auto;
    height: auto;
    object-fit: contain; /* 保持图片比例，不裁剪 */
    display: block;
    border-radius: 8px;
}

/* ========== 聊天详情 / 聊天设置页 ========== */
.xiaoxin-wechat-chat-settings-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #f5f5f5;
    z-index: 120; /* 高于聊天内容与输入栏，但低于其他弹窗 */
    display: flex;
    flex-direction: column;
}

.xiaoxin-wechat-chat-settings-page {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.xiaoxin-wechat-chat-settings-header {
    height: 44px;
    display: flex;
    align-items: center;
    padding: 0 16px;
    background-color: #ededed;
    border-bottom: 0.5px solid #d1d1d6;
}

.xiaoxin-wechat-chat-settings-back {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    cursor: pointer;
}

.xiaoxin-wechat-chat-settings-back:active {
    opacity: 0.6;
}

.xiaoxin-wechat-chat-settings-title {
    flex: 1;
    text-align: center;
    font-size: 17px;
    font-weight: 500;
    color: #000;
    margin-right: 24px; /* 抵消返回按钮空间，保证标题居中 */
}

.xiaoxin-wechat-chat-settings-top {
    padding: 24px 16px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    background-color: #ffffff;
    border-bottom: 0.5px solid #e5e5e5;
}

.xiaoxin-wechat-chat-settings-avatar {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
}

.xiaoxin-wechat-chat-settings-name-wrapper {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.xiaoxin-wechat-chat-settings-name-main {
    font-size: 16px;
    color: #000;
}

.xiaoxin-wechat-chat-settings-name-sub {
    font-size: 13px;
    color: #888;
}

.xiaoxin-wechat-chat-settings-list {
    margin-top: 12px;
}

.xiaoxin-wechat-chat-settings-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    background-color: #ffffff;
    border-bottom: 0.5px solid #e5e5e5;
    font-size: 15px;
    color: #000;
}

.xiaoxin-wechat-chat-settings-item.danger {
    justify-content: center;
    color: #ff3b30;
}

.xiaoxin-wechat-chat-settings-item.history {
    margin-top: 8px;
}

.xiaoxin-wechat-chat-settings-item-label {
    flex: 1;
}

.xiaoxin-wechat-chat-settings-item-arrow {
    font-size: 18px;
    color: #c7c7cc;
}

.xiaoxin-wechat-chat-settings-switch {
    width: 44px;
    height: 26px;
    border-radius: 13px;
    background-color: #e5e5e5;
    position: relative;
    cursor: pointer;
    transition: background-color 0.2s;
}

.xiaoxin-wechat-chat-settings-switch::before {
    content: "";
    position: absolute;
    top: 2px;
    left: 2px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background-color: #ffffff;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s;
}

.xiaoxin-wechat-chat-settings-switch.on {
    background-color: #07c160;
}

.xiaoxin-wechat-chat-settings-switch.on::before {
    transform: translateX(18px);
}

.xiaoxin-wechat-chat-settings-history-section {
    margin-top: 12px;
}

/* ========== 生成历史聊天记录弹窗 ========== */
.xiaoxin-wechat-history-chat-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 200;
}

.xiaoxin-wechat-history-chat-modal {
    background-color: #ffffff;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.xiaoxin-wechat-history-chat-title-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid #e5e5e5;
}

.xiaoxin-wechat-history-chat-title {
    font-size: 18px;
    font-weight: 600;
    color: #000000;
}

.xiaoxin-wechat-history-chat-close {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #666666;
}

.xiaoxin-wechat-history-chat-close:hover {
    color: #000000;
}

.xiaoxin-wechat-history-chat-content {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
}

.xiaoxin-wechat-history-chat-row {
    margin-bottom: 20px;
}

.xiaoxin-wechat-history-chat-row:last-child {
    margin-bottom: 0;
}

.xiaoxin-wechat-history-chat-label {
    font-size: 14px;
    color: #333333;
    margin-bottom: 8px;
}

.xiaoxin-wechat-history-chat-input,
.xiaoxin-wechat-history-chat-select,
input.xiaoxin-wechat-history-chat-input,
select.xiaoxin-wechat-history-chat-select {
    width: 100% !important;
    padding: 10px 12px !important;
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    border-radius: 4px !important;
    font-size: 14px !important;
    color: #000000 !important;
    background-color: #f5f5f5 !important;
    background: #f5f5f5 !important;
    box-sizing: border-box !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    -moz-box-shadow: none !important;
    outline: none !important;
    outline-width: 0 !important;
    outline-style: none !important;
    outline-color: transparent !important;
    /* 强制覆盖所有可能的主题样式 */
    background-image: none !important;
    background-clip: padding-box !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    appearance: none !important;
    transition: none !important;
    -webkit-transition: none !important;
    -moz-transition: none !important;
    -o-transition: none !important;
    /* 不适配酒馆主题，使用固定样式 */
}

.xiaoxin-wechat-history-chat-input:hover,
.xiaoxin-wechat-history-chat-select:hover,
.xiaoxin-wechat-history-chat-input:focus,
.xiaoxin-wechat-history-chat-select:focus,
.xiaoxin-wechat-history-chat-input:active,
.xiaoxin-wechat-history-chat-select:active,
.xiaoxin-wechat-history-chat-input:visited,
.xiaoxin-wechat-history-chat-select:visited,
.xiaoxin-wechat-history-chat-input:not(:focus),
.xiaoxin-wechat-history-chat-select:not(:focus),
input.xiaoxin-wechat-history-chat-input:hover,
select.xiaoxin-wechat-history-chat-select:hover,
input.xiaoxin-wechat-history-chat-input:focus,
select.xiaoxin-wechat-history-chat-select:focus,
input.xiaoxin-wechat-history-chat-input:active,
select.xiaoxin-wechat-history-chat-select:active,
input.xiaoxin-wechat-history-chat-input:visited,
select.xiaoxin-wechat-history-chat-select:visited {
    outline: none !important;
    outline-width: 0 !important;
    outline-style: none !important;
    outline-color: transparent !important;
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    background-color: #f5f5f5 !important;
    background: #f5f5f5 !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    -moz-box-shadow: none !important;
    color: #000000 !important;
    background-image: none !important;
    transition: none !important;
    -webkit-transition: none !important;
    -moz-transition: none !important;
    -o-transition: none !important;
    /* 不适配酒馆主题，使用固定样式 */
}

/* 强制下拉框样式 */
.xiaoxin-wechat-history-chat-select {
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    appearance: none !important;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
    background-repeat: no-repeat !important;
    background-position: right 12px center !important;
    background-color: #f5f5f5 !important;
    padding-right: 32px !important;
    color: #000000 !important;
}

.xiaoxin-wechat-history-chat-select:hover,
.xiaoxin-wechat-history-chat-select:focus,
.xiaoxin-wechat-history-chat-select:active,
.xiaoxin-wechat-history-chat-select:visited {
    background-color: #f5f5f5 !important;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
    color: #000000 !important;
    outline: none !important;
    border: none !important;
    box-shadow: none !important;
}

.xiaoxin-wechat-history-chat-input::placeholder,
.xiaoxin-wechat-history-chat-input::-webkit-input-placeholder,
.xiaoxin-wechat-history-chat-input::-moz-placeholder,
.xiaoxin-wechat-history-chat-input:-ms-input-placeholder {
    color: #999999 !important;
    opacity: 1 !important;
    /* 不适配酒馆主题，使用固定样式 */
}

.xiaoxin-wechat-history-chat-custom-input {
    margin-top: 8px;
    border: none !important;
    background-color: #f5f5f5 !important;
    color: #000000 !important;
    box-shadow: none !important;
    /* 不适配酒馆主题，使用固定样式 */
}

.xiaoxin-wechat-history-chat-custom-input:hover,
.xiaoxin-wechat-history-chat-custom-input:focus,
.xiaoxin-wechat-history-chat-custom-input:active,
.xiaoxin-wechat-history-chat-custom-input:visited,
.xiaoxin-wechat-history-chat-custom-input:not(:focus) {
    outline: none !important;
    outline-width: 0 !important;
    outline-style: none !important;
    outline-color: transparent !important;
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    background-color: #f5f5f5 !important;
    background: #f5f5f5 !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    -moz-box-shadow: none !important;
    color: #000000 !important;
    transition: none !important;
    -webkit-transition: none !important;
    -moz-transition: none !important;
    -o-transition: none !important;
    /* 不适配酒馆主题，使用固定样式 */
}

.xiaoxin-wechat-history-chat-style-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.xiaoxin-wechat-history-chat-custom-input {
    margin-top: 8px;
}

.xiaoxin-wechat-history-chat-footer {
    display: flex;
    gap: 12px;
    padding: 16px 20px;
    border-top: 1px solid #e5e5e5;
}

.xiaoxin-wechat-history-chat-btn {
    flex: 1;
    padding: 12px 20px;
    border: none !important;
    border-radius: 4px;
    font-size: 16px;
    cursor: pointer;
    transition: none !important;
    -webkit-transition: none !important;
    -moz-transition: none !important;
    -o-transition: none !important;
}

.xiaoxin-wechat-history-chat-btn-cancel {
    background-color: #f5f5f5 !important;
    color: #333333 !important;
}

.xiaoxin-wechat-history-chat-btn-cancel:hover,
.xiaoxin-wechat-history-chat-btn-cancel:focus,
.xiaoxin-wechat-history-chat-btn-cancel:active,
.xiaoxin-wechat-history-chat-btn-cancel:visited {
    background-color: #f5f5f5 !important;
    color: #333333 !important;
    box-shadow: none !important;
    outline: none !important;
    border: none !important;
    transform: none !important;
    opacity: 1 !important;
}

.xiaoxin-wechat-history-chat-btn-confirm {
    background-color: #07c160 !important;
    color: #ffffff !important;
}

.xiaoxin-wechat-history-chat-btn-confirm:hover,
.xiaoxin-wechat-history-chat-btn-confirm:focus,
.xiaoxin-wechat-history-chat-btn-confirm:active,
.xiaoxin-wechat-history-chat-btn-confirm:visited {
    background-color: #07c160 !important;
    color: #ffffff !important;
    box-shadow: none !important;
    outline: none !important;
    border: none !important;
    transform: none !important;
    opacity: 1 !important;
}

/* 表情包消息 */
.xiaoxin-wechat-chat-message-emoji {
    padding: 0 !important;
    background: transparent !important;
    border-radius: 4px !important;
    overflow: hidden;
    max-width: 160px;
    max-height: 160px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* 表情包消息禁用默认气泡的小三角 */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-chat-message-bubble.xiaoxin-wechat-chat-message-emoji::after,
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-chat-message-bubble.xiaoxin-wechat-chat-message-emoji::before {
    display: none !important;
    content: none !important;
    border: none !important;
    width: 0 !important;
    height: 0 !important;
}

.xiaoxin-wechat-chat-message-emoji-img {
    width: auto;
    height: auto;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    display: block;
}

/* 红包消息 */
.xiaoxin-wechat-chat-message-redpacket {
    padding: 0 !important;
    background: transparent !important;
    border-radius: 4px !important;
    overflow: visible;
    max-width: 240px;
}

/* 禁用红包消息的默认气泡小三角（使用红包自己的橙色小三角） */
/* 需要更高优先级来覆盖玩家消息的默认绿色小三角 */
/* 红包消息的 bubble 同时有 xiaoxin-wechat-chat-message-bubble 和 xiaoxin-wechat-chat-message-redpacket 类 */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-chat-message-bubble.xiaoxin-wechat-chat-message-redpacket::after {
    display: none !important;
    content: none !important;
    border: none !important;
    width: 0 !important;
    height: 0 !important;
    position: absolute !important;
    top: auto !important;
    right: auto !important;
}

.xiaoxin-wechat-chat-message-redpacket-container {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #ff9c2c;
    border-radius: 4px;
    padding: 12px 14px 32px 14px;
    min-width: 200px;
    position: relative;
    opacity: 1 !important; /* 确保不透明度为100% */
}

/* 红包消息气泡小三角（右侧，橙色）- 玩家发送的消息 */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-chat-message-redpacket-container::after {
    content: "";
    position: absolute;
    top: 12px;
    right: -4px; /* 向内移动2px，让小三角延伸到气泡内部，消除缝隙 */
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 6px solid #ff9c2c;
}

/* 红包消息气泡小三角（左侧，橙色）- 角色发送的消息 */
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-chat-message-redpacket-container::after {
    content: "";
    position: absolute;
    top: 12px;
    left: -4px; /* 向内移动2px，让小三角延伸到气泡内部，消除缝隙 */
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-right: 6px solid #ff9c2c;
}

/* 红包图标：红色方块+金色圆圈+¥符号 */
.xiaoxin-wechat-chat-message-redpacket-icon {
    width: 36px;
    position: relative;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
}

.xiaoxin-wechat-chat-message-redpacket-icon-inner {
    width: 36px;
    height: 36px;
    position: relative;
}

.xiaoxin-wechat-chat-message-redpacket-icon-bg {
    width: 100%;
    height: 120%;
    background: #ff4314;
    border-radius: 4px;
    position: absolute;
    top: 0;
    left: 0;
}

.xiaoxin-wechat-chat-message-redpacket-icon-circle {
    width: 12px;
    height: 12px;
    background: #eed798;
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    align-items: center;
    justify-content: center;
}

.xiaoxin-wechat-chat-message-redpacket-icon-symbol {
    font-size: 10px;
    font-weight: 700;
    color: #fda948;
    line-height: 1;
}

/* 已领取的红包样式 */
.xiaoxin-wechat-chat-message-redpacket-claimed {
    opacity: 1 !important; /* 确保不透明度为100%，不使用透明度 */
}

/* ========== 转账：全屏页面（从底部滑出） ========== */
.xiaoxin-wechat-transfer-overlay {
    /* 绑定在手机容器/聊天页面内，禁止超出手机容器 */
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    z-index: 10050;
    background: #f7f7f7;
    opacity: 0;
    transform: translateY(100%);
    transition: opacity 0.25s ease, transform 0.25s ease;
    overflow-y: auto;
}

.xiaoxin-wechat-transfer-overlay.show {
    opacity: 1;
    transform: translateY(0);
}

.xiaoxin-wechat-transfer-panel {
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    background: #f7f7f7;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}

.xiaoxin-wechat-transfer-top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    background: #f2f2f2;
}

.xiaoxin-wechat-transfer-back,
.xiaoxin-wechat-transfer-more {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    cursor: pointer;
    user-select: none;
}

.xiaoxin-wechat-transfer-back:hover,
.xiaoxin-wechat-transfer-more:hover {
    opacity: 1 !important;
}

.xiaoxin-wechat-transfer-title {
    flex: 1;
    text-align: center;
    font-size: 16px;
    font-weight: 330;
    color: #000;
    padding: 0 8px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.xiaoxin-wechat-transfer-receiver {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    background: #f2f2f2;
    border-bottom: 0.5px solid #e5e5e5;
    gap: 12px;
}

.xiaoxin-wechat-transfer-receiver-info {
    order: 1;
    flex: 1;
    min-width: 0;
    text-align: left;
}

.xiaoxin-wechat-transfer-avatar {
    order: 2;
    width: 44px;
    height: 44px;
    border-radius: 8px;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: #f0f0f0;
    flex-shrink: 0;
}

.xiaoxin-wechat-transfer-receiver-name {
    font-size: 16px;
    font-weight: 330;
    color: #000;
    line-height: 1.2;
}

.xiaoxin-wechat-transfer-receiver-id {
    font-size: 13px;
    color: #8e8e93;
    margin-top: 4px;
}

.xiaoxin-wechat-transfer-amount-box {
    background: #fff;
    margin-top: 10px;
    padding: 14px 16px;
}

.xiaoxin-wechat-transfer-amount-label {
    font-size: 14px;
    color: #000;
    margin-bottom: 10px;
}

.xiaoxin-wechat-transfer-amount-row {
    display: flex;
    align-items: baseline;
    gap: 8px;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 10px;
}

.xiaoxin-wechat-transfer-yen {
    font-size: 28px;
    font-weight: 500;
    color: #000;
}

.xiaoxin-wechat-transfer-amount-text {
    font-size: 44px;
    font-weight: 500;
    color: #000;
    min-height: 52px;
}

.xiaoxin-wechat-transfer-note {
    font-size: 14px;
    color: #8e8e93;
    padding-top: 10px;
    cursor: pointer;
    user-select: none;
}

.xiaoxin-wechat-transfer-note:hover {
    color: #8e8e93 !important;
}

.xiaoxin-wechat-transfer-note.has-note {
    color: #000;
}

.xiaoxin-wechat-transfer-keyboard {
    position: relative;
    width: 100%;
    background: #fff;
    border-top: 1px solid #ddd;
    box-sizing: border-box;
    overflow: hidden;
    max-width: 100%;
    margin-top: auto;
}

.xiaoxin-wechat-transfer-keyboard-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: #ddd;
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    padding-bottom: 35px; /* 为home条留出空间 */
    position: relative;
}

/* 底部home条区域显示为白色 */
.xiaoxin-wechat-transfer-keyboard-grid::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 35px;
    background: #fff;
    z-index: 1;
}

.xiaoxin-wechat-transfer-keyboard-key {
    background: #fff;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: #000;
    cursor: pointer;
    user-select: none;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    transition: background-color 0.1s;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    width: 100%;
    min-width: 0;
}

.xiaoxin-wechat-transfer-keyboard-key:hover {
    background: #fff !important;
}

.xiaoxin-wechat-transfer-keyboard-key:active {
    background: #e0e0e0;
}

/* 删除键（第一行右侧） */
.xiaoxin-wechat-transfer-keyboard-delete {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

.xiaoxin-wechat-transfer-keyboard-delete svg {
    width: 24px;
    height: 24px;
    display: block;
}

/* 转账按钮（绿色，跨第2-4行） */
.xiaoxin-wechat-transfer-keyboard-confirm {
    background: #07c160 !important;
    background-color: #07c160 !important;
    color: #fff !important;
    -webkit-text-fill-color: #fff !important;
    font-size: 18px;
    font-weight: 500;
    grid-row: 2 / 5; /* 跨第2-4行 */
    grid-column: 4; /* 第4列 */
    height: auto; /* 自动高度，覆盖固定高度 */
    min-height: 150px; /* 3行的高度 */
}

.xiaoxin-wechat-transfer-keyboard-confirm:hover {
    background: #07c160 !important;
    background-color: #07c160 !important;
}

.xiaoxin-wechat-transfer-keyboard-confirm:active {
    background: #06ad56 !important;
    background-color: #06ad56 !important;
}

/* 空白键（占位，不可点击） */
.xiaoxin-wechat-transfer-keyboard-blank {
    background: #fff;
    cursor: default;
    pointer-events: none;
}

.xiaoxin-wechat-transfer-keyboard-blank:active {
    background: #fff;
}

/* ========== 转账：付款方式选择弹窗 ========== */
.xiaoxin-wechat-transfer-payment-overlay {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 10060;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.25s ease;
}

.xiaoxin-wechat-transfer-payment-overlay.show {
    opacity: 1;
}

.xiaoxin-wechat-transfer-payment-dialog {
    width: 85%;
    max-width: 400px;
    max-height: 80vh;
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transform: scale(0.9);
    transition: transform 0.25s ease;
}

.xiaoxin-wechat-transfer-payment-overlay.show
    .xiaoxin-wechat-transfer-payment-dialog {
    transform: scale(1);
}

.xiaoxin-wechat-transfer-payment-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid #e5e5e5;
    position: relative;
}

.xiaoxin-wechat-transfer-payment-title {
    flex: 1;
    text-align: center;
    font-size: 18px;
    font-weight: 500;
    color: #000;
}

.xiaoxin-wechat-transfer-payment-close {
    position: absolute;
    right: 20px;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    color: #8e8e93;
    cursor: pointer;
    user-select: none;
}

.xiaoxin-wechat-transfer-payment-close:hover {
    color: #000;
}

.xiaoxin-wechat-transfer-payment-content {
    flex: 1;
    overflow-y: auto;
    padding: 8px 0;
}

.xiaoxin-wechat-transfer-payment-option {
    display: flex;
    align-items: center;
    padding: 16px 20px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s;
}

.xiaoxin-wechat-transfer-payment-option:hover {
    background: #f5f5f5;
}

.xiaoxin-wechat-transfer-payment-option-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    flex-shrink: 0;
}

.xiaoxin-wechat-transfer-payment-option-info {
    flex: 1;
    min-width: 0;
}

.xiaoxin-wechat-transfer-payment-option-name {
    font-size: 16px;
    font-weight: 400;
    color: #000;
    margin-bottom: 4px;
}

.xiaoxin-wechat-transfer-payment-option-desc {
    font-size: 13px;
    color: #8e8e93;
}

.xiaoxin-wechat-transfer-payment-option-check {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.xiaoxin-wechat-transfer-payment-section {
    padding: 12px 20px 8px 20px;
    font-size: 14px;
    color: #8e8e93;
    font-weight: 400;
}

.xiaoxin-wechat-transfer-payment-cards-list {
    padding: 0;
}

.xiaoxin-wechat-transfer-payment-empty {
    padding: 16px 20px;
    text-align: center;
    font-size: 14px;
    color: #8e8e93;
}

.xiaoxin-wechat-transfer-payment-confirm {
    margin: 12px 20px 20px 20px;
    padding: 14px 0;
    background: #07c160;
    color: #fff;
    text-align: center;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    user-select: none;
}

.xiaoxin-wechat-transfer-payment-confirm:hover {
    background: #06ad56;
}

.xiaoxin-wechat-transfer-payment-confirm:active {
    background: #059c4f;
}

/* ========== 转账：聊天气泡卡片 ========== */
/* 转账消息：橙色气泡样式（使用更高优先级的选择器） */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-chat-message-transfer
    .xiaoxin-wechat-chat-message-bubble,
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-chat-message-transfer
    .xiaoxin-wechat-chat-message-bubble {
    background: #ff9c2c !important;
    background-color: #ff9c2c !important;
    border-radius: 4px !important;
    padding: 12px 14px !important;
    min-width: 180px;
    min-height: 80px !important; /* 两个头像的高度：40px * 2 = 80px */
    height: 80px !important;
    position: relative;
    opacity: 1 !important;
    color: #fff !important;
    display: flex !important;
    align-items: center !important;
}

/* 玩家侧转账消息：右侧小三角（橙色，使用类选择器组合提高优先级） */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-chat-message-bubble.xiaoxin-wechat-chat-message-transfer::after {
    content: "" !important;
    position: absolute !important;
    top: 12px !important;
    right: -4px !important;
    width: 0 !important;
    height: 0 !important;
    border-top: 6px solid transparent !important;
    border-bottom: 6px solid transparent !important;
    border-left: 6px solid #ff9c2c !important;
    border-right: none !important;
    display: block !important;
}

/* 联系人侧转账消息：左侧小三角（橙色，使用类选择器组合提高优先级） */
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-chat-message-bubble.xiaoxin-wechat-chat-message-transfer::after {
    content: "" !important;
    position: absolute !important;
    top: 12px !important;
    left: -4px !important;
    width: 0 !important;
    height: 0 !important;
    border-top: 6px solid transparent !important;
    border-bottom: 6px solid transparent !important;
    border-right: 6px solid #ff9c2c !important;
    border-left: none !important;
    display: block !important;
}

.xiaoxin-wechat-chat-message-transfer .xiaoxin-wechat-chat-transfer-card {
    min-width: 180px;
    width: 100%;
    /* 稍微拉高卡片高度，让内容更舒展 */
    min-height: 64px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
}

.xiaoxin-wechat-chat-transfer-row1 {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 8px;
    width: 100%;
}

.xiaoxin-wechat-chat-transfer-icon {
    /* 放大转账图标整体尺寸 */
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: #fff;
}

.xiaoxin-wechat-chat-transfer-icon svg {
    width: 100%;
    height: 100%;
}

.xiaoxin-wechat-chat-transfer-title {
    font-size: 14px;
    color: #fff;
    flex-shrink: 0;
}

.xiaoxin-wechat-chat-transfer-amount {
    font-size: 18px;
    font-weight: 500;
    color: #fff;
    flex-shrink: 0;
}

.xiaoxin-wechat-chat-transfer-row2 {
    margin-top: 6px;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.9);
    width: 100%;
    text-align: left;
}

/* 已领取的红包：气泡颜色变浅 */
/* 注意：claimed 和 container 是同一个元素上的两个类，需要使用类选择器组合 */
.xiaoxin-wechat-chat-message-redpacket-container.xiaoxin-wechat-chat-message-redpacket-claimed {
    background: #ffc286 !important; /* 浅橙色 */
}

/* 已领取的红包：玩家侧三角指向颜色变浅 */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-chat-message-redpacket-container.xiaoxin-wechat-chat-message-redpacket-claimed::after {
    border-left-color: #ffc286 !important; /* 浅橙色 */
}

/* 已领取的红包：联系人侧三角指向颜色变浅 */
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-chat-message-redpacket-container.xiaoxin-wechat-chat-message-redpacket-claimed::after {
    border-right-color: #ffc286 !important; /* 浅橙色 */
}

/* 已领取的红包图标（打开状态） */
.xiaoxin-wechat-chat-message-redpacket-icon-opened {
    position: relative;
}

.xiaoxin-wechat-chat-message-redpacket-icon-bg-opened {
    width: 100%;
    height: 120%;
    background: #ff4314;
    border-radius: 4px;
    position: absolute;
    top: 0;
    left: 0;
    /* 打开的红包底部显示更多，模拟打开效果 */
    clip-path: polygon(0 30%, 100% 30%, 100% 100%, 0 100%);
}

/* 红包盖子（打开状态，向上翻起） */
.xiaoxin-wechat-chat-message-redpacket-icon-flap {
    width: 100%;
    height: 40%;
    background: #ff4314;
    border-radius: 4px 4px 0 0;
    position: absolute;
    top: 0;
    left: 0;
    transform-origin: bottom center;
    transform: rotateX(-45deg) perspective(50px);
    box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.2);
}

.xiaoxin-wechat-chat-message-redpacket-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
    color: #fff;
}

.xiaoxin-wechat-chat-message-redpacket-note {
    font-size: 15px;
    color: #fff;
    font-weight: 500;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
}

.xiaoxin-wechat-chat-message-redpacket-divider {
    width: 100%;
    height: 1px;
    background: rgba(255, 255, 255, 0.3);
    margin: 2px 0;
}

.xiaoxin-wechat-chat-message-redpacket-label {
    font-size: 11px;
    color: #fff;
    font-weight: 400;
    line-height: 1.2;
    opacity: 0.9;
    text-align: center;
    white-space: nowrap;
    position: absolute;
    top: 50px;
    left: 40%;
    transform: translateX(-50%);
    width: 100%;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
}

/* 语音消息：显示为 XX\" + 语音图标（通用基础样式） */
.xiaoxin-wechat-chat-message-voice {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    min-width: 120px; /* 统一长度 */
}

/* 玩家侧语音：时长在左，图标在右，整体靠右 */
.xiaoxin-wechat-chat-message-voice-player {
    justify-content: flex-end;
    padding: 4px 10px 4px 18px; /* 上下变窄，让整体高度贴近文本气泡和头像 */
    cursor: pointer; /* 添加指针样式，提示可点击 */
    transition: opacity 0.2s ease;
}

.xiaoxin-wechat-chat-message-voice-player:hover {
    opacity: 0.8; /* 悬停时稍微透明，提供视觉反馈 */
}

/* 角色侧语音：图标在左，时长在右，整体靠左 */
.xiaoxin-wechat-chat-message-voice-contact {
    justify-content: flex-start;
    padding: 4px 18px 4px 10px;
    cursor: pointer; /* 添加指针样式，提示可点击 */
    transition: opacity 0.2s ease;
}

.xiaoxin-wechat-chat-message-voice-contact:hover {
    opacity: 0.8; /* 悬停时稍微透明，提供视觉反馈 */
}

.xiaoxin-wechat-chat-voice-duration {
    font-size: 16px;
}

.xiaoxin-wechat-chat-voice-icon {
    width: 32px;
    height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.xiaoxin-wechat-chat-voice-icon svg {
    width: 30px;
    height: 30px;
    display: block;
}

/* 聊天页面内：角色侧未读语音的小红点 */
.xiaoxin-wechat-voice-unread-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #ff3b30;
    margin-left: 6px;
    align-self: center; /* 在消息内容容器中垂直居中，贴在气泡侧面中间位置 */
}

/* 语音消息文字转写容器 */
.xiaoxin-wechat-voice-transcription-container {
    margin-top: 4px;
    margin-left: 0;
    margin-right: 0;
    width: 100%;
    flex-basis: 100%; /* 确保换行显示在语音气泡下方 */
    display: flex;
    animation: fadeIn 0.2s ease-in;
}

/* 角色侧文字转写容器（左对齐） */
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-voice-transcription-container {
    justify-content: flex-start;
}

/* 玩家侧文字转写容器（右对齐） */
.xiaoxin-wechat-chat-message-player
    .xiaoxin-wechat-voice-transcription-container {
    justify-content: flex-end;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 文字转写气泡（样式与消息气泡一致，但无小三角） */
.xiaoxin-wechat-voice-transcription-bubble {
    display: inline-block;
    padding: 10px 14px;
    border-radius: 4px; /* 完全圆角，无小三角 */
    font-size: 16px;
    font-weight: 330 !important;
    line-height: 1.4;
    word-wrap: break-word;
    word-break: break-all;
    position: relative;
    max-width: calc(100% - 60px); /* 与普通文本气泡的宽度阈值一致 */
}

/* 角色侧文字转写气泡（白色，左对齐） */
.xiaoxin-wechat-chat-message-contact
    .xiaoxin-wechat-voice-transcription-bubble {
    background: #fff !important;
    color: #000 !important;
    margin-left: 50px; /* 与语音气泡前端对齐（头像宽度40px + 间距10px） */
    margin-right: auto;
}

/* 玩家侧文字转写气泡（白色，右对齐） */
.xiaoxin-wechat-chat-message-player .xiaoxin-wechat-voice-transcription-bubble {
    background: #fff !important; /* 强制白色背景 */
    color: #000 !important; /* 强制黑色文字 */
    margin-left: auto;
    margin-right: 50px !important; /* 与语音气泡右端对齐（头像宽度40px + 间距10px） */
}

/* 文字转写文本样式 */
.xiaoxin-wechat-voice-transcription-text {
    font-size: 16px;
    line-height: 1.4;
    font-weight: 330 !important;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
        "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
    text-align: left !important; /* 强制左对齐 */
}

/* 角色侧文字转写文本（黑色） */
.xiaoxin-wechat-chat-message-contact .xiaoxin-wechat-voice-transcription-text {
    color: #000;
    text-align: left !important; /* 强制左对齐 */
}

/* 玩家侧文字转写文本（黑色） */
.xiaoxin-wechat-chat-message-player .xiaoxin-wechat-voice-transcription-text {
    color: #000;
    text-align: left !important; /* 强制左对齐 */
}

/* 玩家侧语音图标水平翻转（角色侧保持默认朝向） */
.xiaoxin-wechat-chat-message-player .xiaoxin-wechat-chat-voice-icon svg {
    transform: scaleX(-1);
}

/* ========== 底部输入栏 ========== */
.xiaoxin-wechat-chat-input-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 94px; /* 增加高度以容纳安全区 */
    background: #f2f2f2 !important; /* 整体背景改为更浅的灰色 */
    background-color: #f2f2f2 !important;
    border-top: 0.5px solid #d1d1d6;
    display: flex;
    align-items: flex-start; /* 顶部对齐 */
    padding: 8px 12px 42px; /* 增加底部内边距 */
    gap: 8px;
    z-index: 99;
    box-sizing: border-box;
}

/* 菜单栏展开时，确保输入栏底部区域（home条区域）显示菜单栏的背景色 */
.xiaoxin-wechat-chat-input-bar.xiaoxin-wechat-chat-input-bar-menu-expanded {
    background: #f2f2f2 !important; /* 确保背景色与菜单栏一致 */
    background-color: #f2f2f2 !important;
}

.xiaoxin-wechat-chat-input-bar.xiaoxin-wechat-chat-input-bar-menu-expanded::before {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 42px; /* 安全区高度 */
    background: #f2f2f2; /* 与菜单栏背景色一致 */
    z-index: 0; /* 确保在输入栏内容下方但在背景上方 */
    pointer-events: none; /* 不阻挡点击事件 */
}

.xiaoxin-wechat-chat-input-voice,
.xiaoxin-wechat-chat-input-emoji,
.xiaoxin-wechat-chat-input-add {
    width: 34px;
    height: 34px;
    display: block;
    cursor: pointer;
    user-select: none;
    flex-shrink: 0;
    background-size: 26px 26px; /* 图标略微放大 */
    background-position: center;
    background-repeat: no-repeat;
}

.xiaoxin-wechat-chat-input-voice:active,
.xiaoxin-wechat-chat-input-emoji:active,
.xiaoxin-wechat-chat-input-add:active {
    opacity: 0.6;
}

/* 底部输入栏按钮图标 */
.xiaoxin-wechat-chat-input-voice {
    background-image: url("/scripts/extensions/third-party/xiaoxin-phone/image/icon/语音按钮.jpg");
    background-color: transparent; /* 确保背景透明，显示图标 */
}

.xiaoxin-wechat-chat-input-emoji {
    background-image: url("/scripts/extensions/third-party/xiaoxin-phone/image/icon/表情按钮.png");
    background-color: transparent; /* 确保背景透明，显示图标 */
}

.xiaoxin-wechat-chat-input-add {
    background-image: url("/scripts/extensions/third-party/xiaoxin-phone/image/icon/聊天功能按钮.jpg");
    background-color: transparent; /* 确保背景透明，显示图标 */
}

.xiaoxin-wechat-chat-input-field {
    flex: 1;
    height: 36px;
    padding: 0 12px;
    border: none !important;
    border-radius: 4px;
    background: #e4e4e4 !important; /* 输入框背景略微加深，与底部栏区分开 */
    background-color: #e4e4e4 !important;
    font-size: 16px;
    color: #000 !important;
    outline: none !important;
    box-sizing: border-box;
    -webkit-appearance: none !important;
    appearance: none !important;
    -webkit-text-fill-color: #000 !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
}

.xiaoxin-wechat-chat-input-field::placeholder {
    color: #999 !important;
    -webkit-text-fill-color: #999 !important;
    opacity: 1 !important;
}

.xiaoxin-wechat-chat-input-field:focus,
.xiaoxin-wechat-chat-input-field:active,
.xiaoxin-wechat-chat-input-field:hover {
    background: #e4e4e4 !important;
    background-color: #e4e4e4 !important;
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    color: #000 !important;
    -webkit-text-fill-color: #000 !important;
}

/* 彻底屏蔽主题对输入框的覆盖（更高优先级） */
.xiaoxin-wechat-chat-input-bar .xiaoxin-wechat-chat-input-field {
    background: #e4e4e4 !important;
    background-color: #e4e4e4 !important;
    color: #000 !important;
    border: none !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    filter: none !important;
    -webkit-filter: none !important;
    opacity: 1 !important;
}

/* 取消聊天详情页底部多余的背景留白 */
.xiaoxin-wechat-chat-detail-main {
    padding-bottom: 0 !important;
}

/* ========== 表情包面板 ========== */
.xiaoxin-wechat-chat-sticker-bar {
    position: absolute;
    bottom: calc(12px + env(safe-area-inset-bottom, 0px)); /* 兼容刘海/底栏 */
    left: 0;
    right: 0;
    height: clamp(200px, 38vh, 260px); /* 随屏幕高度自适应 */
    background: #f2f2f2;
    border-top: 0.5px solid #d1d1d6;
    display: none; /* 初始隐藏，展开时改为 flex */
    flex-direction: column;
    z-index: 100; /* 高于输入栏，确保显示在输入框上方 */
    box-sizing: border-box;
    animation: slideUpMenu 0.2s ease-out;
}

/* 表情包分组标签栏 */
.xiaoxin-wechat-chat-sticker-tabs {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 8px 10px;
    gap: 6px;
    border-bottom: 0.5px solid #d1d1d6;
    background: #f2f2f2;
    overflow-x: auto;
    overflow-y: hidden;
    flex-shrink: 0;
    -webkit-overflow-scrolling: touch;
    position: relative;
}

.xiaoxin-wechat-chat-sticker-tabs::-webkit-scrollbar {
    display: none;
}

.xiaoxin-wechat-chat-sticker-tab {
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    cursor: pointer;
    user-select: none;
    flex-shrink: 0;
    transition: background-color 0.2s ease, color 0.2s ease;
    color: #8e8e93;
    background: transparent;
    overflow: hidden; /* 确保图片不超出边界 */
    padding: 0; /* 无内边距 */
}

.xiaoxin-wechat-chat-sticker-tab svg {
    width: 24px;
    height: 24px;
    stroke: currentColor; /* 使用线条样式 */
    fill: none; /* 不填充 */
}

/* 图片图标样式 - 填充满整个区域，1:1比例，无边距 */
.xiaoxin-wechat-chat-sticker-tab img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important; /* 填充满整个区域 */
    border-radius: 8px; /* 与标签栏圆角一致 */
    padding: 0 !important;
    margin: 0 !important;
    display: block;
}

.xiaoxin-wechat-chat-sticker-tab.active {
    background: rgba(0, 0, 0, 0.08);
    color: #000; /* 激活状态使用黑色 */
}

.xiaoxin-wechat-chat-sticker-tab.active svg {
    stroke: #000; /* 确保激活时是黑色线条 */
}

/* 标签栏右侧虚线框加号 */
.xiaoxin-wechat-chat-sticker-tab-add {
    border: 2px dashed #b9b9b9;
    background: rgba(255, 255, 255, 0.6);
    margin-left: auto; /* 推到最后 */
    flex-shrink: 0; /* 防止被压缩 */
    position: sticky;
    right: 0;
    background: rgba(
        255,
        255,
        255,
        0.95
    ); /* 确保背景不透明，避免被滚动内容遮挡 */
    z-index: 1;
}

.xiaoxin-wechat-chat-sticker-tab-add-icon {
    font-size: 20px;
    line-height: 1;
    color: #8e8e93;
    font-weight: 330;
}

/* ========== 创建表情包分组弹窗 ========== */
.xiaoxin-sticker-category-dialog {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 100000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.xiaoxin-sticker-category-dialog-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
}

.xiaoxin-sticker-category-dialog-content {
    position: relative;
    width: 90%;
    max-width: 400px;
    max-height: 80vh;
    background: #fff;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    overflow: hidden;
}

/* 在手机容器内显示“创建表情包分组”弹窗时，自适应手机屏幕并稍微下移 */
.xiaoxin-phone-container .xiaoxin-sticker-category-dialog {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    padding-top: 40px;  /* 向下移动一些，避免贴着手机顶部 */
    padding-bottom: 40px;
    box-sizing: border-box;
    overflow: hidden;   /* 防止弹窗超出手机容器 */
}

.xiaoxin-phone-container .xiaoxin-sticker-category-dialog-content {
    width: 80%;
    max-width: 320px;
    max-height: 70vh;
    margin: auto;       /* 在手机容器内部水平垂直居中 */
}

.xiaoxin-sticker-category-dialog-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 0.5px solid #e5e5e5;
}

.xiaoxin-sticker-category-dialog-title {
    font-size: 18px;
    font-weight: 500;
    color: #000;
}

.xiaoxin-sticker-category-dialog-close {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    font-size: 20px;
    color: #8e8e93;
    cursor: pointer;
    border-radius: 4px;
    transition: none !important; /* 取消过渡效果 */
}

/* 取消关闭按钮的所有悬停效果 */
.xiaoxin-sticker-category-dialog-close:hover,
.xiaoxin-sticker-category-dialog-close:active,
.xiaoxin-sticker-category-dialog-close:focus {
    background: transparent !important;
    color: #8e8e93 !important;
}

.xiaoxin-sticker-category-dialog-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    -webkit-overflow-scrolling: touch;
}

.xiaoxin-sticker-category-preview-section {
    margin-bottom: 24px;
}

.xiaoxin-sticker-category-preview-label {
    font-size: 14px;
    color: #8e8e93;
    margin-bottom: 12px;
}

.xiaoxin-sticker-category-preview {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 120px;
    background: #f5f5f5;
    border-radius: 8px;
    border: 1px solid #e5e5e5;
}

.xiaoxin-sticker-category-preview-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
}

.xiaoxin-sticker-category-preview-icon svg {
    width: 24px;
    height: 24px;
    stroke: currentColor;
    fill: none;
}

.xiaoxin-sticker-category-input-section {
    margin-bottom: 24px;
}

.xiaoxin-sticker-category-input-label,
.xiaoxin-sticker-category-icon-label {
    font-size: 14px;
    color: #8e8e93;
    margin-bottom: 8px;
}

.xiaoxin-sticker-category-name-input,
.xiaoxin-sticker-category-name-input:focus,
.xiaoxin-sticker-category-name-input:active,
.xiaoxin-sticker-category-name-input:hover,
.xiaoxin-sticker-category-name-input:visited,
.xiaoxin-sticker-category-name-input::placeholder {
    width: 100% !important;
    padding: 12px !important;
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    border-radius: 8px !important;
    font-size: 16px !important;
    box-sizing: border-box !important;
    outline: none !important;
    outline-width: 0 !important;
    outline-style: none !important;
    outline-color: transparent !important;
    background: #e4e4e4 !important;
    background-color: #e4e4e4 !important;
    background-image: none !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    -moz-box-shadow: none !important;
    color: #000 !important; /* 强制黑色文字 */
    -webkit-text-fill-color: #000 !important; /* WebKit浏览器强制黑色 */
}

.xiaoxin-sticker-category-icon-section {
    margin-bottom: 24px;
}

.xiaoxin-sticker-category-icon-options {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
}

.xiaoxin-sticker-category-icon-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border: 1px solid #e5e5e5;
    border-radius: 8px;
    cursor: pointer;
    transition: none !important; /* 取消过渡效果 */
}

/* 取消图标选项的所有悬停效果 */
.xiaoxin-sticker-category-icon-option:hover,
.xiaoxin-sticker-category-icon-option:active,
.xiaoxin-sticker-category-icon-option:focus {
    border-color: #e5e5e5 !important;
    background: transparent !important;
}

.xiaoxin-sticker-category-icon-option input[type="radio"] {
    margin: 0;
    width: 18px;
    height: 18px;
    cursor: pointer;
    /* 移除默认样式 */
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    appearance: none !important;
    border: 2px solid #000 !important; /* 黑色线条 */
    border-radius: 50% !important;
    background: transparent !important; /* 无填充 */
    background-color: transparent !important; /* 确保无填充 */
    position: relative;
    outline: none !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    -moz-box-shadow: none !important;
    transition: none !important;
    padding: 0 !important;
}

.xiaoxin-sticker-category-icon-option input[type="radio"]:checked {
    border-color: #07c160 !important; /* 外圈绿色 */
    background: transparent !important;
    box-shadow: none !important;
    outline: none !important;
}

/* 选中时的内部圆点（缩小，不填满） */
.xiaoxin-sticker-category-icon-option input[type="radio"]:checked::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px; /* 缩小圆点，不填满 */
    height: 8px;
    border-radius: 50%;
    background: #07c160;
    box-shadow: none !important;
}

.xiaoxin-sticker-category-icon-option input[type="radio"]:checked + span {
    color: #000 !important; /* 改为黑色 */
    font-weight: 500;
}

.xiaoxin-sticker-category-icon-option span {
    color: #000 !important; /* "文字""图片"字样改成黑色 */
}

/* 移除所有悬停和聚焦效果 */
.xiaoxin-sticker-category-icon-option input[type="radio"]:hover,
.xiaoxin-sticker-category-icon-option input[type="radio"]:focus,
.xiaoxin-sticker-category-icon-option input[type="radio"]:active {
    outline: none !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    -moz-box-shadow: none !important;
    border-color: #000 !important; /* 保持黑色 */
    background: transparent !important; /* 保持无填充 */
    background-color: transparent !important;
}

.xiaoxin-sticker-category-icon-option input[type="radio"]:checked:hover,
.xiaoxin-sticker-category-icon-option input[type="radio"]:checked:focus,
.xiaoxin-sticker-category-icon-option input[type="radio"]:checked:active {
    outline: none !important;
    box-shadow: none !important;
    border-color: #07c160 !important;
}

.xiaoxin-sticker-category-text-input-wrapper {
    margin-top: 12px;
}

.xiaoxin-sticker-category-text-input,
.xiaoxin-sticker-category-text-input:focus,
.xiaoxin-sticker-category-text-input:active,
.xiaoxin-sticker-category-text-input:hover,
.xiaoxin-sticker-category-text-input:visited,
.xiaoxin-sticker-category-text-input::placeholder {
    width: 100% !important;
    padding: 12px !important;
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    border-radius: 8px !important;
    font-size: 16px !important;
    text-align: center !important;
    box-sizing: border-box !important;
    outline: none !important;
    outline-width: 0 !important;
    outline-style: none !important;
    outline-color: transparent !important;
    background: #e4e4e4 !important;
    background-color: #e4e4e4 !important;
    background-image: none !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    -moz-box-shadow: none !important;
    color: #000 !important; /* 强制黑色文字 */
    -webkit-text-fill-color: #000 !important; /* WebKit浏览器强制黑色 */
}

.xiaoxin-sticker-category-image-input-wrapper {
    margin-top: 12px;
}

.xiaoxin-sticker-category-image-btn {
    width: 100%;
    padding: 12px;
    border: 1px solid #e5e5e5;
    border-radius: 8px;
    background: #fff;
    font-size: 16px;
    color: #576b95;
    cursor: pointer;
    transition: none !important; /* 取消过渡效果 */
}

/* 取消所有悬停效果 */
.xiaoxin-sticker-category-image-btn:hover,
.xiaoxin-sticker-category-image-btn:active,
.xiaoxin-sticker-category-image-btn:focus {
    background: #fff !important;
    color: #576b95 !important;
}

.xiaoxin-sticker-category-image-divider {
    margin: 12px 0;
    text-align: center;
    color: #8e8e93;
    font-size: 14px;
}

.xiaoxin-sticker-category-image-url-input,
.xiaoxin-sticker-category-image-url-input:focus,
.xiaoxin-sticker-category-image-url-input:active,
.xiaoxin-sticker-category-image-url-input:hover,
.xiaoxin-sticker-category-image-url-input:visited,
.xiaoxin-sticker-category-image-url-input::placeholder {
    width: 100% !important;
    padding: 12px !important;
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    border-radius: 8px !important;
    font-size: 16px !important;
    box-sizing: border-box !important;
    outline: none !important;
    outline-width: 0 !important;
    outline-style: none !important;
    outline-color: transparent !important;
    background: #e4e4e4 !important;
    background-color: #e4e4e4 !important;
    background-image: none !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
    -moz-box-shadow: none !important;
    margin-top: 12px !important;
    color: #000 !important; /* 强制黑色文字 */
    -webkit-text-fill-color: #000 !important; /* WebKit浏览器强制黑色 */
}

.xiaoxin-sticker-category-image-preview {
    margin-top: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.xiaoxin-sticker-category-dialog-footer {
    display: flex;
    gap: 12px;
    padding: 16px 20px;
    border-top: 0.5px solid #e5e5e5;
}

.xiaoxin-sticker-category-dialog-cancel,
.xiaoxin-sticker-category-dialog-create {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: none !important; /* 取消过渡效果 */
}

.xiaoxin-sticker-category-dialog-cancel {
    background: #f5f5f5 !important;
    color: #000 !important;
}

/* 取消取消按钮的所有悬停效果 */
.xiaoxin-sticker-category-dialog-cancel:hover,
.xiaoxin-sticker-category-dialog-cancel:active,
.xiaoxin-sticker-category-dialog-cancel:focus {
    background: #f5f5f5 !important;
    color: #000 !important;
}

.xiaoxin-sticker-category-dialog-create {
    background: #07c160 !important; /* 改为绿色 */
    background-color: #07c160 !important;
    color: #fff !important;
}

/* 取消创建按钮的所有悬停效果 */
.xiaoxin-sticker-category-dialog-create:hover,
.xiaoxin-sticker-category-dialog-create:active,
.xiaoxin-sticker-category-dialog-create:focus {
    background: #07c160 !important;
    background-color: #07c160 !important;
    color: #fff !important;
}

.xiaoxin-wechat-chat-sticker-tab:active {
    background: rgba(0, 0, 0, 0.12);
}

/* 表情包内容区域（可滚动） */
.xiaoxin-wechat-chat-sticker-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 12px;
    -webkit-overflow-scrolling: touch;
}

.xiaoxin-wechat-chat-sticker-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 固定每行4格 */
    gap: 6px 6px;
    width: 100%;
    padding: 2px 2px; /* 略微增加左右缓冲，防止贴边 */
    box-sizing: border-box;
}

.xiaoxin-wechat-chat-sticker-item {
    width: 100%;
    min-height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    background: transparent;
    transition: background-color 0.2s ease;
    padding: 0; /* 移除 padding，避免边框被裁剪 */
    box-sizing: border-box;
    overflow: visible; /* 确保边框完全显示 */
}

.xiaoxin-wechat-chat-sticker-item:active {
    background-color: rgba(0, 0, 0, 0.08);
}

.xiaoxin-wechat-chat-sticker-img {
    width: auto;
    height: auto;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    pointer-events: none;
}

/* 左上角虚线框 + */
.xiaoxin-wechat-chat-sticker-add {
    border: 2px dashed #b9b9b9;
    background: rgba(255, 255, 255, 0.6);
    padding: 0;
    box-sizing: border-box; /* 确保边框计算在尺寸内 */
    overflow: visible; /* 确保边框完全显示 */
    width: calc(100% - 4px); /* 缩小一点，留出边框空间 */
    height: calc(100% - 4px); /* 缩小一点，留出边框空间 */
    margin: 2px; /* 添加外边距，确保边框不被裁剪 */
}

.xiaoxin-wechat-chat-sticker-add-plus {
    font-size: 28px; /* 进一步减小加号大小，与缩小后的容器匹配 */
    line-height: 1;
    color: #8e8e93;
    font-weight: 330;
}

/* ========== 加号按钮菜单栏 ========== */
.xiaoxin-wechat-chat-menu-bar {
    position: absolute;
    bottom: 20px; /* 位于输入框下方，往上移动20px避免遮挡home条 */
    left: 0;
    right: 0;
    background: #f2f2f2;
    border-top: 0.5px solid #d1d1d6;
    padding: 12px;
    padding-bottom: 12px; /* 确保底部有足够的内边距 */
    display: none; /* 初始隐藏 */
    z-index: 97; /* z-index低于输入框，确保输入框在菜单栏上方 */
    box-sizing: border-box;
    /* 确保菜单栏不超出手机容器 */
    /* 使用100%高度减去导航栏和输入栏的高度，再减去安全边距和home条高度 */
    max-height: calc(100% - 44px - 94px - 40px);
    overflow-y: auto;
    overflow-x: hidden;
    /* 菜单栏在输入框下方，往上移动避免遮挡home条 */
}

/* 菜单网格布局 */
.xiaoxin-wechat-chat-menu-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4列布局 */
    gap: 16px 12px; /* 行间距16px，列间距12px */
    width: 100%;
}

/* 菜单项 */
.xiaoxin-wechat-chat-menu-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
    padding: 8px;
    border-radius: 8px;
    transition: background-color 0.2s ease;
}

.xiaoxin-wechat-chat-menu-item:active {
    background-color: rgba(0, 0, 0, 0.1);
}

/* 菜单图标 */
.xiaoxin-wechat-chat-menu-icon {
    width: 60px;
    height: 60px;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    margin-bottom: 8px;
    border-radius: 8px;
}

/* 菜单标签 */
.xiaoxin-wechat-chat-menu-label {
    font-size: 14px;
    color: #000;
    text-align: center;
    font-weight: 330;
    line-height: 1.2;
}

/* 确保菜单栏在手机容器内 */
.xiaoxin-wechat-chat-screen {
    position: relative;
    overflow: hidden; /* 防止菜单栏超出容器 */
}

/* 菜单栏展开时的动画 */
.xiaoxin-wechat-chat-menu-bar {
    animation: slideUpMenu 0.2s ease-out;
}

@keyframes slideUpMenu {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ========== 图片查看器（点击放大） ========== */
.xiaoxin-wechat-image-viewer {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.xiaoxin-wechat-image-viewer.active {
    display: flex;
    opacity: 1;
}

.xiaoxin-wechat-image-viewer-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    cursor: pointer;
}

.xiaoxin-wechat-image-viewer-img {
    position: relative;
    max-width: 90vw;
    max-height: 90vh;
    width: auto;
    height: auto;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    z-index: 10001;
    cursor: zoom-out;
    user-select: none;
    -webkit-user-drag: none;
}

.xiaoxin-wechat-image-viewer-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 300;
    cursor: pointer;
    z-index: 10002;
    transition: background 0.2s ease, transform 0.2s ease;
    user-select: none;
}

.xiaoxin-wechat-image-viewer-close:hover {
    background: rgba(0, 0, 0, 0.8);
    transform: scale(1.1);
}

.xiaoxin-wechat-image-viewer-close:active {
    transform: scale(0.95);
}

/* ========== 通话选择窗口（从底部滑出） ========== */
.xiaoxin-call-options-dialog {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10001;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    /* 确保弹窗在手机容器内 */
    overflow: hidden;
}

.xiaoxin-call-options-dialog.show {
    opacity: 1;
    pointer-events: auto;
}

.xiaoxin-call-options-dialog-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1;
}

.xiaoxin-call-options-dialog-content {
    position: relative;
    width: 100%;
    max-width: 100%;
    background: #ffffff;
    border-radius: 16px 16px 0 0;
    padding: 12px 0;
    z-index: 2;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.xiaoxin-call-options-dialog.show .xiaoxin-call-options-dialog-content {
    transform: translateY(0);
}

.xiaoxin-call-options-item {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px 20px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s ease;
    min-height: 56px;
    box-sizing: border-box;
}

.xiaoxin-call-options-item:active {
    background-color: rgba(0, 0, 0, 0.05);
}

.xiaoxin-call-options-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    flex-shrink: 0;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
}

.xiaoxin-call-options-icon-video {
    background-image: url("/scripts/extensions/third-party/xiaoxin-phone/image/icon/视频通话选择按钮.jpg");
}

.xiaoxin-call-options-icon-voice {
    background-image: url("/scripts/extensions/third-party/xiaoxin-phone/image/icon/语音通话选择按钮.jpg");
}

.xiaoxin-call-options-label {
    font-size: 16px;
    color: #000000;
    font-weight: 400;
    text-align: center;
}

.xiaoxin-call-options-cancel .xiaoxin-call-options-label {
    text-align: center;
    color: #576b95;
}

.xiaoxin-call-options-divider {
    height: 8px;
    background: #f2f2f2;
    margin: 4px 0;
}

/* ========== 添加表情包弹窗 ========== */
.xiaoxin-add-sticker-dialog {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
}

.xiaoxin-add-sticker-dialog-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1;
}

.xiaoxin-add-sticker-dialog-content {
    position: relative;
    width: 90%;
    max-width: 400px;
    max-height: 80vh;
    background: #fff;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    z-index: 2;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

/* 在手机容器内显示添加表情包弹窗时，自适应手机屏幕并略微下移 */
.xiaoxin-phone-container .xiaoxin-add-sticker-dialog {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    padding-top: 40px; /* 向下移动一些，避免顶到手机状态栏 */
    padding-bottom: 40px;
    box-sizing: border-box;
    overflow: hidden; /* 确保弹窗不超出手机容器 */
}

.xiaoxin-phone-container .xiaoxin-add-sticker-dialog-content {
    width: 80%;
    max-width: 320px;
    max-height: 70vh;
    margin: auto; /* 在手机容器内部居中 */
}

.xiaoxin-add-sticker-dialog-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 0.5px solid #e5e5e5;
}

.xiaoxin-add-sticker-dialog-title {
    font-size: 18px;
    font-weight: 500;
    color: #000;
}

.xiaoxin-add-sticker-dialog-close {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    color: #8e8e93;
    font-size: 20px;
    cursor: pointer;
    border-radius: 4px;
    padding: 0;
    transition: none !important;
}

.xiaoxin-add-sticker-dialog-close:hover,
.xiaoxin-add-sticker-dialog-close:active,
.xiaoxin-add-sticker-dialog-close:focus {
    background: transparent !important;
    color: #8e8e93 !important;
}

.xiaoxin-add-sticker-dialog-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    -webkit-overflow-scrolling: touch;
}

.xiaoxin-add-sticker-preview-section {
    margin-bottom: 20px;
}

.xiaoxin-add-sticker-preview-label {
    font-size: 14px;
    color: #8e8e93;
    margin-bottom: 8px;
}

.xiaoxin-add-sticker-preview {
    width: 100%;
    height: 120px;
    background: #f5f5f5;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.xiaoxin-add-sticker-preview-icon {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.xiaoxin-add-sticker-input-section {
    margin-bottom: 20px;
}

.xiaoxin-add-sticker-input-label {
    font-size: 14px;
    color: #000;
    margin-bottom: 8px;
    font-weight: 500;
}

.xiaoxin-add-sticker-description-input {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
}

.xiaoxin-add-sticker-image-section {
    margin-bottom: 20px;
}

.xiaoxin-add-sticker-image-label {
    font-size: 14px;
    color: #000;
    margin-bottom: 8px;
    font-weight: 500;
}

.xiaoxin-add-sticker-image-input-wrapper {
    width: 100%;
}

.xiaoxin-add-sticker-image-btn {
    width: 100%;
    padding: 12px;
    background: #f5f5f5 !important;
    background-color: #f5f5f5 !important;
    color: #000 !important;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
    transition: none !important;
}

.xiaoxin-add-sticker-image-btn:hover,
.xiaoxin-add-sticker-image-btn:active,
.xiaoxin-add-sticker-image-btn:focus {
    background: #f5f5f5 !important;
    background-color: #f5f5f5 !important;
    color: #000 !important;
}

.xiaoxin-add-sticker-image-url-input {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
    margin-top: 12px;
}

.xiaoxin-add-sticker-image-preview {
    margin-top: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.xiaoxin-add-sticker-dialog-footer {
    display: flex;
    gap: 12px;
    padding: 16px 20px;
    border-top: 0.5px solid #e5e5e5;
}

.xiaoxin-add-sticker-dialog-cancel,
.xiaoxin-add-sticker-dialog-add {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: none !important;
}

.xiaoxin-add-sticker-dialog-cancel {
    background: #f5f5f5 !important;
    color: #000 !important;
}

.xiaoxin-add-sticker-dialog-cancel:hover,
.xiaoxin-add-sticker-dialog-cancel:active,
.xiaoxin-add-sticker-dialog-cancel:focus {
    background: #f5f5f5 !important;
    color: #000 !important;
}

.xiaoxin-add-sticker-dialog-add {
    background: #07c160 !important;
    background-color: #07c160 !important;
    color: #fff !important;
}

.xiaoxin-add-sticker-dialog-add:hover,
.xiaoxin-add-sticker-dialog-add:active,
.xiaoxin-add-sticker-dialog-add:focus {
    background: #07c160 !important;
    background-color: #07c160 !important;
    color: #fff !important;
}

/* ========== 红包弹窗样式 ========== */
.xiaoxin-wechat-redpacket-modal-overlay {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background: rgba(255, 255, 255, 0.9) !important;
    z-index: 10000 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    animation: fadeIn 0.3s ease;
    margin: 0 !important;
    padding: 0 !important;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.xiaoxin-wechat-redpacket-modal {
    width: 280px;
    max-width: 90%;
    background: #ff583a;
    border-radius: 12px;
    padding: 32px 20px 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    animation: slideUp 0.3s ease;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    margin: 0 auto;
    min-height: 400px;
}

@keyframes slideUp {
    from {
        transform: translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* 发送者信息（头像和文字并排显示，整体居中） */
.xiaoxin-wechat-redpacket-modal-sender {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 16px;
    width: 100%;
}

.xiaoxin-wechat-redpacket-modal-sender-avatar {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    object-fit: cover;
    flex-shrink: 0;
}

.xiaoxin-wechat-redpacket-modal-sender-name {
    font-size: 14px;
    color: #fff8dc;
    text-align: center;
    flex: 0 1 auto;
}

/* 红包备注 */
.xiaoxin-wechat-redpacket-modal-note {
    font-size: 18px;
    font-weight: 500;
    color: #fff8dc;
    text-align: center;
    margin-bottom: 24px;
    line-height: 1.4;
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* 红包图标容器 */
.xiaoxin-wechat-redpacket-modal-icon {
    position: relative;
    width: 120px;
    height: 140px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-top: 20px;
}

.xiaoxin-wechat-redpacket-modal-icon-inner {
    position: relative;
    width: 100px;
    height: 120px;
    margin-bottom: 16px;
}

.xiaoxin-wechat-redpacket-modal-icon-bg {
    width: 100%;
    height: 100%;
    background: #ff4314;
    border-radius: 8px;
    position: absolute;
    top: 0;
    left: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.xiaoxin-wechat-redpacket-modal-icon-circle {
    width: 60px;
    height: 60px;
    background: #ffd700;
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.xiaoxin-wechat-redpacket-modal-icon-symbol {
    font-size: 28px;
    font-weight: bold;
    color: #ff4314;
    line-height: 1;
}

/* "开"按钮 */
.xiaoxin-wechat-redpacket-modal-open-button {
    width: 80px;
    height: 80px;
    background: #ffeea8;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: 500;
    color: #414141;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    position: relative;
    z-index: 1;
    margin-top: 40px;
    transform-style: preserve-3d;
    perspective: 1000px;
}

.xiaoxin-wechat-redpacket-modal-open-button:active {
    transform: scale(0.95);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

.xiaoxin-wechat-redpacket-modal-open-button:hover:not(.rotating) {
    transform: scale(1.05);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
}

/* 旋转动画：横向3D旋转两周（像钱币一样） */
@keyframes redpacket-coin-rotate {
    0% {
        transform: rotateY(0deg) scale(1);
    }
    50% {
        transform: rotateY(360deg) scale(1.1);
    }
    100% {
        transform: rotateY(720deg) scale(1.2);
    }
}

.xiaoxin-wechat-redpacket-modal-open-button.rotating {
    pointer-events: none;
}

/* ========== 红包领取通知 ========== */
.xiaoxin-wechat-redpacket-claim-notification {
    width: 100%;
    text-align: center;
    padding: 8px 16px;
    margin: 8px 0;
    font-size: 13px;
    color: #888;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 4px;
    box-sizing: border-box;
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
